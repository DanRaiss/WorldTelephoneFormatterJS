/**
 * Made by Dany for Objedname 2022
 * This object was made for formatting telephone numbers with correct state prefix
*/
var TelephoneFormatter = new function(){
    var countryPrefixes = new Map([
        ['CZ', '+420'],
        ['SK', '+421'],
        ['DE', '+49'],
        ['AT', '+43'],
        ['AF', '+93'],
        ['AL', '+355'],
        ['DZ', '+213'],
        ['AS', '+1684'],
        ['VI', '+134'],
        ['AD', '+376'],
        ['AO', '+244'],
        ['AI', '+1264'],     
        ['AQ', '+672'],  
        ['AG', '+1268'], 
        ['AR', '+54'], 
        ['AM', '+374'], 
        ['AW', '+297'], 
        ['AU', '+61'], 
        ['AZ', '+994'], 
        ['BS', '+1242'], 
        ['BH', '+973'], 
        ['BD', '+880'], 
        ['BB', '+1246'], 
        ['BE', '+32'], 
        ['BZ', '+501'], 
        ['BY', '+375'],  
        ['BJ', '+229'],  
        ['BM', '+1441'],  
        ['BT', '+975'],  
        ['BO', '+591'],  
        ['BQ', '+599'],  
        ['BA', '+387'],  
        ['BW', '+267'], 
        ['BR', '+55'],
        ['IO', '+246'],
        ['VG', '+1284'],
        ['BN', '+673'],
        ['BG', '+359'],
        ['BF', '+226'],
        ['BI', '+257'],
        ['CK', '+682'],
        ['CW', '+599'],
        ['TD', '+235'],
        ['ME', '+382'],
        ['CN', '+86'],
        ['DK', '+45'],
        ['CD', '+243'],
        ['DM', '+1767'],
        ['DO', '+1809'],
        ['DJ', '+253'],
        ['EG', '+20'],
        ['EC', '+593'],
        ['ER', '+291'],
        ['EE', '+372'],	
        ['ET', '+251'],
        ['EU', '+388'],
        ['FO', '+298'],
        ['FK', '+500'],
        ['FJ', '+679'],
        ['PH', '+63'],
        ['FI', '+358'],
        ['FR', '+33'],
        ['GF', '+594'],
        ['TF', '+262'],
        ['PF', '+689'],
        ['GA', '+241'],
        ['GM', '+220'],
        ['GH', '+233'],			
        ['GI', '+350'],
        ['GD', '+1473'],
        ['GL', '+299'],
        ['GE', '+995'],
        ['GP', '+590'],
        ['GU', '+1671'],
        ['GT', '+502'],
        ['GN', '+224'],
        ['GW', '+245'],
        ['GG', '+44'],
        ['JE', '+44'],
        ['IM', '+44'],
        ['GB', '+44'],
        ['GY', '+592'],
        ['HT', '+509'],
        ['HN', '+504'],
        ['HK', '+852'],
        ['CL', '+56'],
        ['HR', '+385'],
        ['IN', '+91'],
        ['ID', '+62'],
        ['IQ', '+964'],
        ['IR', '+98'],
        ['IE', '+353'],
        ['IS', '+354'],
        ['IT', '+39'],
        ['IL', '+972'],
        ['JM', '+1876'],
        ['JP', '+81'],
        ['YE', '+967'],
        ['ZA', '+27'],
        ['GS', '+55'],
        ['KR', '+82'],
        ['SS', '+211'],
        ['JO', '+962'],
        ['KY', '+1345'],
        ['KH', '+855'],
        ['CM', '+237'],
        ['CA', '+1'],
        ['US', '+1'],
        ['SX', '+1'],
        ['CV', '+238'],
        ['QA', '+974'],
        ['KZ', '+7'],
        ['KE', '+254'],
        ['KI', '+686'],
        ['CC', '+61'],
        ['CO', '+57'],
        ['KM', '+269'],
        ['CG', '+242'],
        ['CR', '+506'],
        ['CU', '+53'],
        ['KW', '+965'],
        ['CY', '+357'],
        ['KG', '+996'],
        ['LA', '+856'],
        ['LS', '+266'],
        ['LB', '+961'],
        ['LR', '+231'],
        ['LY', '+218'],
        ['LI', '+423'],
        ['LT', '+370'],
        ['LV', '+371'],
        ['LU', '+352'],
        ['MO', '+853'],
        ['MG', '+261'],	
        ['HU', '+36'],
        ['MY', '+60'],
        ['MW', '+265'],
        ['MV', '+960'],
        ['ML', '+223'],
        ['MT', '+356'],
        ['MA', '+212'],
        ['MH', '+692'],
        ['MQ', '+596'],
        ['MU', '+230'],
        ['MR', '+222'],
        ['YT', '+262'],
        ['UM', '+246'],
        ['MX', '+52'],	
        ['FM', '+691'],
        ['MD', '+373'],
        ['MC', '+377'],
        ['MN', '+976'],
        ['MS', '+1664'],
        ['MZ', '+258'],
        ['MM', '+95'],
        ['NA', '+264'],
        ['NR', '+674'],
        ['NP', '+977'],
        ['NE', '+227'],
        ['NG', '+234'],
        ['NI', '+505'],
        ['NU', '+683'],
        ['NL', '+31'],		
        ['NF', '+672'],
        ['NO', '+47'],
        ['NC', '+687'],
        ['NZ', '+64'],
        ['OM', '+968'],
        ['PK', '+92'],
        ['PW', '+680'],
        ['PS', '+970'],
        ['PA', '+507'],
        ['PG', '+675'],
        ['PY', '+595'],
        ['PE', '+51'],
        ['PN', '+64'],
        ['CI', '+225'],
        ['PL', '+48'],
        ['PR', '+1939'],
        ['PT', '+351'],
        ['AT', '+43'],
        ['RE', '+262'],
        ['GQ', '+240'],
        ['RO', '+40'],
        ['RU', '+7'],
        ['RW', '+250'],
        ['GR', '+30'],
        ['PM', '+508'],
        ['SV', '+503'],
        ['WS', '+685'],
        ['SM', '+378'],
        ['SA', '+966'],
        ['SN', '+221'],
        ['KP', '+850'],
        ['MK', '+389'],
        ['MP', '+167'],
        ['SC', '+248'],
        ['SL', '+232'],
        ['SG', '+65'],
        ['SI', '+386'],
        ['SO', '+252'],
        ['AE', '+971'],
        ['RS', '+381'],
        ['LK', '+94'],
        ['CF', '+236'],
        ['SD', '+249'],
        ['SR', '+597'],
        ['SH', '+290'],
        ['LC', '+1758'],
        ['BL', '+590'],
        ['MF', '+590'],
        ['KN', '+1869'],
        ['ST', '+239'],
        ['VC', '+1784'],
        ['SZ', '+268'],
        ['SY', '+963'],
        ['SB', '+677'],
        ['ES', '+34'],
        ['SJ', '+47'],
        ['SE', '+46'],
        ['CH', '+41'],
        ['TJ', '+992'],
        ['TZ', '+255'],
        ['TH', '+66'],
        ['TW', '+886'],
        ['TG', '+228'],
        ['TK', '+690'],
        ['TO', '+676'],
        ['TT', '+1868'],
        ['TN', '+216'],
        ['TR', '+90'],
        ['TM', '+993'],
        ['TC', '+1649'],
        ['TV', '+688'],
        ['UG', '+256'],
        ['UA', '+380'],
        ['UY', '+598'],
        ['UZ', '+998'],
        ['CX', '+61'],
        ['VU', '+678'],
        ['VA', '+39'],
        ['VE', '+58'],
        ['VN', '+84'],
        ['TL', '+670'],
        ['WF', '+681'],
        ['XG', '+881'],
        ['XU', '+878'],
        ['XN', '+882'],
        ['XR', '+979'],
        ['XF', '+800'],
        ['XS', '+870'],
        ['ZM', '+260'],
        ['ZW', '+263'], 
    ]);

    function removePrefix(tel, prefix){
        tel = tel.replace(/\s/g, "")
        if (tel.substring(0, prefix.length) == prefix){
            tel = tel.substring(tel, prefix.length);
        }  
        return tel;
    }
    /**
     * This function will return formatted number with spaces after 3 chars and correct prefix, 
     * @param tel telephone number in string format
     * @param predefinedCountry default(CZ) country code
    */
    this.normalize = function(tel, predefinedCountry = "CZ"){
        tel = tel.replace(/\s/g, "");
        tel = tel.replaceAll("-", "");

        let correctPrefix = countryPrefixes.get(predefinedCountry);
        tel = removePrefix(removePrefix(tel, correctPrefix), "00".replace("+", ""), correctPrefix);

        var res = correctPrefix + " " + this.makeSpaces(tel);
        return res;
    }

    this.makeSpaces = function(string) {
        return string.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }
}
